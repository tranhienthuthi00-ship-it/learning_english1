<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Marshmallow English</title>

<style>
*{box-sizing:border-box;font-family:system-ui,sans-serif}
body{margin:0;background:#faf6ee;color:#222}

header{
  background:#f4efe5;padding:16px 20px;
  display:flex;flex-wrap:wrap;align-items:center;justify-content:space-between;gap:10px;
}
.logo{font-weight:700;font-size:22px}
#userStats{background:#fff;padding:6px 14px;border-radius:18px;font-size:13px;font-weight:600;box-shadow:0 6px 14px rgba(0,0,0,.12)}

nav{display:flex;flex-wrap:wrap;gap:8px}
nav a{text-decoration:none;color:#222;font-size:15px;cursor:pointer;opacity:.5}
nav a.active{font-weight:700;opacity:1}

.search-input{
  width:40px;height:38px;border-radius:20px;border:none;
  background:#f49ac2;color:white;padding:0 16px;transition:.3s;outline:none
}
.search-input.active{width:180px}
.search-input::placeholder{color:#fff}

main{padding:40px 16px;text-align:center}
.tab{display:none}.tab.active{display:block}

.home-gif{margin:10px 0 30px;display:flex;justify-content:center}
.home-gif img{width:70%;max-width:280px}

.sub-tabs button{
  margin:6px;padding:8px 16px;border-radius:22px;
  border:none;cursor:pointer;background:#eee;font-weight:600;
}

.flashcard{
  width:95%;max-width:440px;min-height:220px;margin:20px auto;
  background:#f49ac2;border-radius:26px;color:white;
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  gap:12px;font-size:24px;cursor:pointer;padding:20px;
  box-shadow:0 12px 26px rgba(0,0,0,.15);
}
.flash-example{font-size:15px;opacity:.9}
.flash-actions{display:flex;justify-content:center;gap:12px;flex-wrap:wrap}
.flash-actions button{padding:8px 18px;border-radius:22px;border:none;font-weight:600;cursor:pointer}
.skip{background:#ddd}.next{background:#f49ac2;color:white}

.game-card{background:#f1eddc;border-radius:18px;padding:14px;margin:8px auto;max-width:420px;cursor:pointer}
.game-card.correct{background:#b9f6ca}
.game-card.wrong{background:#ffcdd2}
.listen-btn{width:56px;height:56px;border-radius:50%;border:none;background:#f49ac2;color:white;font-size:24px;cursor:pointer;margin:16px auto}

.dict-app{max-width:720px;margin:auto;text-align:left}
.dict-search{
  width:100%;padding:12px 16px;border-radius:22px;border:none;
  outline:none;font-size:16px;box-shadow:0 6px 16px rgba(0,0,0,.1);
}
.dict-card{background:#fff;padding:12px;margin:10px 0;border-radius:18px;cursor:pointer}
.dict-type{font-size:12px;color:#f49ac2;margin-top:4px;font-weight:600}
.dict-example{font-style:italic;font-size:13px;color:#666}
.hl-word{color:#f49ac2;font-weight:600}

.stats{max-width:420px;margin:20px auto;background:#fff;padding:20px;border-radius:22px;text-align:left}
</style>
</head>

<body>

<header>
  <div class="logo">üç° Tr·∫ßn Hi·ªÅn</div>
  <nav>
    <a data-tab="home" class="active" onclick="showTab('home')">Home</a>
    <a data-tab="english" onclick="showTab('english')">English</a>
    <a data-tab="journey" onclick="showTab('journey')">Journey</a>
    <a data-tab="food" onclick="showTab('food')">Food</a>
  </nav>

  <input id="searchInput" class="search-input"
      placeholder="üîçÔ∏é T√¨m b√†i vi·∫øt"
      onfocus="this.classList.add('active')"
      onblur="if(!this.value)this.classList.remove('active')">

  <div id="userStats">
    ‚≠ê Level <span id="lv">1</span> ¬∑ üíé <span id="score">0</span>
  </div>
</header>

<main>
<section id="home" class="tab active"><div class="home-gif"><img src="https://media4.giphy.com/media/10a1Cwco2kUtlS/giphy.gif"></div></section>
<section id="journey" class="tab"><div class="home-gif"><img src="https://media0.giphy.com/media/kIRwx1dWD9cnuNe0NB/giphy.gif"></div></section>
<section id="food" class="tab"><div class="home-gif"><img src="https://media3.giphy.com/media/7uLj32hcCziZq2rr5K/giphy.gif"></div></section>

<section id="english" class="tab">
  <div class="home-gif"><img src="https://media0.giphy.com/media/HiKpToupuCj9UwQkWP/giphy.gif"></div>
  <div class="sub-tabs">
    <button onclick="openFlash()">Flashcard</button>
    <button onclick="openGame()">Game</button>
    <button onclick="openGame2()">Game 2</button>
    <button onclick="openDict()">Dictionary</button>
    <button onclick="openStructure()">Structure</button>
    <button onclick="openStats()">Stats</button>
  </div>
  <div id="englishContent">‚ú® Ch·ªçn ch·∫ø ƒë·ªô h·ªçc</div>
</section>
</main>

<script>
function showTab(id){
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'))
  document.getElementById(id).classList.add('active')
  document.querySelectorAll('nav a').forEach(a=>a.classList.remove('active'))
  document.querySelector(`nav a[data-tab="${id}"]`).classList.add('active')
}

let learned=JSON.parse(localStorage.getItem("guest_learned")||"{}")
let correct=JSON.parse(localStorage.getItem("guest_correct")||"{}")
let score=Number(localStorage.getItem("guest_score")||0)

const scoreEl=document.getElementById("score")
const lv=document.getElementById("lv")
function updateStatsUI(){
  scoreEl.innerText=score
  lv.innerText=Math.floor(score/100)+1
}
function save(){
  localStorage.setItem("guest_learned",JSON.stringify(learned))
  localStorage.setItem("guest_correct",JSON.stringify(correct))
  localStorage.setItem("guest_score",score)
  updateStatsUI()
}
updateStatsUI()

const WORD_URL="https://opensheet.elk.sh/11RjgH-4a8mENEkDNTv2UFsRzZGy73JJ9YNXz5HR2Tt8/Sheet1"
let words=[]
fetch(WORD_URL).then(r=>r.json()).then(d=>words=d)

const STRUCT_URL="https://opensheet.elk.sh/11RjgH-4a8mENEkDNTv2UFsRzZGy73JJ9YNXz5HR2Tt8/Sheet2"
let structures=[]
fetch(STRUCT_URL).then(r=>r.json()).then(d=>structures=d)

let englishContent=document.getElementById("englishContent")

/* FLASHCARD */
let fi=0,front=true
function openFlash(){
  const w=words[fi]; if(!w)return
  englishContent.innerHTML=`<div class="flashcard" onclick="flip()">${front?w.EN:w.VI}${!front&&w.Example?`<div class="flash-example">${w.Example}</div>`:""}</div>
  <div class="flash-actions"><button class="skip" onclick="markKnown()">ƒê√£ bi·∫øt</button><button class="next" onclick="nextFlash()">Next</button></div>`
  speak(w.EN)
}
function flip(){front=!front;openFlash()}
function nextFlash(){fi=(fi+1)%words.length;front=true;openFlash()}
function markKnown(){if(!learned[words[fi].EN]){learned[words[fi].EN]=true;score+=5}save();nextFlash()}

/* GAME */
let gameIndex=0
function openGame(){englishContent.innerHTML=`<div id="gameArea"></div>`;gameListen()}
function gameListen(){
  const w=words[gameIndex]; if(!w)return
  speak(w.EN)
  const opts=[w.VI]
  while(opts.length<3){let r=words[Math.random()*words.length|0].VI;if(!opts.includes(r))opts.push(r)}
  opts.sort(()=>Math.random()-.5)
  gameArea.innerHTML=`<button class="listen-btn" onclick="speak('${w.EN}')">üîä</button>
  ${opts.map(o=>`<div class="game-card" onclick="checkListen(this,'${o}','${w.VI}')">${o}</div>`).join("")}
  <div id="result"></div>`
}
function checkListen(el,c,a){
  document.querySelectorAll('.game-card').forEach(x=>x.onclick=null)
  const ok=c===a
  el.classList.add(ok?'correct':'wrong')
  result.innerText=ok?'‚úÖ ƒê√∫ng':'‚ùå Sai'
  if(ok && !correct[words[gameIndex].EN]){correct[words[gameIndex].EN]=true;score+=10}
  save()
  setTimeout(()=>{gameIndex=(gameIndex+1)%words.length;gameListen()},1000)
}

/* DICTIONARY */
function openDict(){
  englishContent.innerHTML=`<div class="dict-app">
    <input class="dict-search" placeholder="T√¨m t·ª´..." oninput="searchDict(this.value)">
    <div id="dictList"></div></div>`
  renderDict(words,"")
}
function renderDict(list,key){
  const k=key.toLowerCase()
  dictList.innerHTML=list.map(w=>{
    let ex=w.Example||""
    if(ex && k){ex=ex.replace(new RegExp(`(${k})`,"gi"),`<span class="hl-word">$1</span>`)}
    return`<div class="dict-card" data-en="${encodeURIComponent(w.EN)}">
      <b>${w.EN}</b> ‚Äì ${w.VI}
      ${w.Type?`<div class="dict-type">${w.Type}</div>`:""}
      <div class="dict-example">${ex}</div>
    </div>`
  }).join("")
  document.querySelectorAll('.dict-card').forEach(c=>c.onclick=()=>speak(decodeURIComponent(c.dataset.en)))
}
function searchDict(k){
  const key=k.toLowerCase()
  renderDict(words.filter(w=>w.EN.toLowerCase().includes(key)||w.VI.toLowerCase().includes(key)),k)
}

/* STRUCTURE */
function openStructure(){
  englishContent.innerHTML=`<div class="dict-app">
    <input class="dict-search" placeholder="T√¨m c·∫•u tr√∫c..." oninput="searchStructure(this.value)">
    <div id="structList"></div></div>`
  renderStructure(structures,"")
}
function renderStructure(list,key){
  const k=key.toLowerCase()
  structList.innerHTML=list.map(s=>{
    let ex=s.Example||""
    if(ex && k){ex=ex.replace(new RegExp(`(${k})`,"gi"),`<span class="hl-word">$1</span>`)}
    return`<div class="dict-card"><b>${s.Structure}</b>
    <div class="dict-type">${s.Description||""}</div>
    <div class="dict-example">${ex}</div></div>`
  }).join("")
}
function searchStructure(k){
  const key=k.toLowerCase()
  renderStructure(structures.filter(s=>
    s.Structure.toLowerCase().includes(key)||
    (s.Description||"").toLowerCase().includes(key)||
    (s.Example||"").toLowerCase().includes(key)
  ),k)
}

/* STATS */
function openStats(){
  englishContent.innerHTML=`<div class="stats">
    <h3>üìä Th·ªëng k√™</h3>
    <p>T·ªïng t·ª´: ${words.length}</p>
    <p>ƒê√£ bi·∫øt: ${Object.keys(learned).length}</p>
    <p>Tr·∫£ l·ªùi ƒë√∫ng: ${Object.keys(correct).length}</p>
    <p>ƒêi·ªÉm: ${score}</p>
    <p>Level: ${Math.floor(score/100)+1}</p>
  </div>`
}

function speak(t){
  speechSynthesis.cancel()
  const u=new SpeechSynthesisUtterance(t)
  u.lang="en-US"
  speechSynthesis.speak(u)
}
</script>

</body>
</html>
