<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Marshmallow English</title>

<style>
*{box-sizing:border-box;font-family:system-ui,sans-serif}
body{margin:0;background:#faf6ee;color:#222}

/* AUTH */
#authScreen{
  position:fixed;inset:0;
  background:#faf6ee;
  display:flex;align-items:center;justify-content:center;
  z-index:9999;
}
.auth-box{
  background:#fff;
  padding:32px;
  border-radius:26px;
  width:320px;
  box-shadow:0 20px 40px rgba(0,0,0,.15);
  text-align:center;
}
.auth-box input{
  width:100%;padding:12px;
  border-radius:18px;border:1px solid #ddd;
  margin-bottom:12px;
}
.auth-main{
  width:100%;padding:12px;
  border-radius:22px;border:none;
  background:#f49ac2;color:white;
  font-weight:600;cursor:pointer;
}
.auth-alt{
  margin-top:10px;
  background:none;border:none;
  color:#f49ac2;font-weight:600;
  cursor:pointer;
}

/* HEADER */
header{
  background:#f4efe5;
  padding:16px 40px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  position:relative;
}
.logo{font-weight:700;font-size:22px}

/* USER STATS */
#userStats{
  position:absolute;
  top:18px;right:40px;
  background:#fff;
  padding:8px 16px;
  border-radius:18px;
  font-size:13px;
  font-weight:600;
  box-shadow:0 6px 14px rgba(0,0,0,.12);
}

/* NAV */
nav a{
  margin:0 12px;
  text-decoration:none;
  color:#222;
  font-size:14px;
  cursor:pointer;
  opacity:.5;
}
nav a.active{font-weight:700;opacity:1}

/* SEARCH */
.search-input{
  width:44px;height:40px;border-radius:20px;border:none;
  background:#f49ac2;color:white;padding:0 16px;
  transition:.3s;outline:none
}
.search-input.active{width:260px}
.search-input::placeholder{color:#fff}

/* MAIN */
main{padding:60px 40px;text-align:center}

/* TAB */
.tab{display:none}
.tab.active{display:block}

/* GIF */
.home-gif{margin:-50px 0 50px;display:flex;justify-content:center}
.home-gif img{width:180px}

/* SUB TABS */
.sub-tabs button{
  margin:8px;
  padding:10px 20px;
  border-radius:22px;
  border:none;
  cursor:pointer;
  background:#eee;
  font-weight:600;
}

/* FLASHCARD */
.flashcard{
  width:440px;min-height:260px;margin:40px auto 20px;
  background:#f49ac2;border-radius:26px;color:white;
  display:flex;flex-direction:column;
  align-items:center;justify-content:center;
  gap:12px;font-size:28px;
  cursor:pointer;padding:24px;
  box-shadow:0 12px 26px rgba(0,0,0,.15);
}
.flash-example{font-size:16px;opacity:.9}

/* FLASH BUTTONS */
.flash-actions{display:flex;justify-content:center;gap:16px}
.flash-actions button{
  padding:10px 22px;border-radius:22px;
  border:none;font-weight:600;cursor:pointer;
}
.skip{background:#ddd}
.next{background:#f49ac2;color:white}

/* GAME */
.game-card{
  background:#f1eddc;border-radius:18px;
  padding:16px;margin:10px auto;
  max-width:420px;cursor:pointer;
}
.game-card.correct{background:#b9f6ca}
.game-card.wrong{background:#ffcdd2}
.listen-btn{
  width:60px;height:60px;border-radius:50%;
  border:none;background:#f49ac2;
  color:white;font-size:26px;
  cursor:pointer;margin:20px auto;
}

/* DICT */
.dict-app{max-width:720px;margin:auto;text-align:left}
.dict-search{
  width:100%;padding:14px 18px;
  border-radius:22px;border:none;
  outline:none;font-size:16px;
  box-shadow:0 6px 16px rgba(0,0,0,.1);
}
.dict-card{
  background:#fff;padding:14px;
  margin:12px 0;border-radius:18px;
  cursor:pointer;
}
.dict-example{font-style:italic;font-size:13px;color:#666}

/* STATS */
.stats{
  max-width:420px;margin:40px auto;
  background:#fff;padding:24px;
  border-radius:22px;text-align:left;
}
</style>
</head>

<body>

<!-- AUTH -->
<div id="authScreen">
  <div class="auth-box">
    <h2>üç° Marshmallow</h2>
    <p style="font-size:13px;opacity:.6">ƒêƒÉng nh·∫≠p ƒë·ªÉ h·ªçc</p>
    <input id="authUser" placeholder="T√™n ƒëƒÉng nh·∫≠p">
    <input id="authPass" type="password" placeholder="M·∫≠t kh·∫©u">
    <button class="auth-main" onclick="login()">ƒêƒÉng nh·∫≠p</button>
    <button class="auth-alt" onclick="register()">T·∫°o t√†i kho·∫£n</button>
    <div id="authMsg" style="font-size:13px;margin-top:10px"></div>
  </div>
</div>

<header>
  <div class="logo">üç° Tr·∫ßn Hi·ªÅn</div>
  <nav>
    <a data-tab="home" class="active" onclick="showTab('home')">Home</a>
    <a data-tab="english" onclick="showTab('english')">English</a>
    <a data-tab="journey" onclick="showTab('journey')">Journey</a>
    <a data-tab="food" onclick="showTab('food')">Food</a>
  </nav>

  <div>
    <input id="searchInput" class="search-input"
      placeholder="üîçÔ∏é T√¨m b√†i vi·∫øt"
      onfocus="this.classList.add('active')"
      onblur="if(!this.value)this.classList.remove('active')">
    <button onclick="logout()" style="background:none;border:none;font-weight:600;cursor:pointer">
      Logout
    </button>
  </div>

  <div id="userStats">
    ‚≠ê Lv <span id="lv">1</span> ¬∑ üíé <span id="score">0</span>
  </div>
</header>

<main>
<section id="home" class="tab active">
  <div class="home-gif">
    <img src="https://media4.giphy.com/media/10a1Cwco2kUtlS/giphy.gif">
  </div>
</section>

<section id="journey" class="tab">
  <div class="home-gif">
    <img src="https://media0.giphy.com/media/kIRwx1dWD9cnuNe0NB/giphy.gif">
  </div>
</section>

<section id="food" class="tab">
  <div class="home-gif">
    <img src="https://media3.giphy.com/media/7uLj32hcCziZq2rr5K/giphy.gif">
  </div>
</section>

<section id="english" class="tab">
  <div class="home-gif">
    <img src="https://media0.giphy.com/media/HiKpToupuCj9UwQkWP/giphy.gif">
  </div>
  <div class="sub-tabs">
    <button onclick="openFlash()">Flashcard</button>
    <button onclick="openGame()">Game</button>
    <button onclick="openDict()">Dictionary</button>
    <button onclick="openStats()">Stats</button>
  </div>
  <div id="englishContent">‚ú® Ch·ªçn ch·∫ø ƒë·ªô h·ªçc</div>
</section>
</main>

<script>
/* NAV */
function showTab(id){
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'))
  document.getElementById(id).classList.add('active')
  document.querySelectorAll('nav a').forEach(a=>a.classList.remove('active'))
  document.querySelector(`nav a[data-tab="${id}"]`).classList.add('active')
}

/* AUTH + DATA */
let currentUser=localStorage.getItem("currentUser")
let learned={},correct={},score=0

function login(){
  const u=authUser.value.trim(),p=authPass.value
  const users=JSON.parse(localStorage.getItem("users")||"{}")
  if(!users[u]||users[u]!==p){authMsg.innerText="‚ùå Sai th√¥ng tin";return}
  localStorage.setItem("currentUser",u)
  initUser(u)
}
function register(){
  const u=authUser.value.trim(),p=authPass.value
  if(!u||!p){authMsg.innerText="‚ö†Ô∏è Nh·∫≠p ƒë·ªß";return}
  const users=JSON.parse(localStorage.getItem("users")||"{}")
  if(users[u]){authMsg.innerText="‚ö†Ô∏è ƒê√£ t·ªìn t·∫°i";return}
  users[u]=p
  localStorage.setItem("users",JSON.stringify(users))
  authMsg.innerText="‚úÖ T·∫°o th√†nh c√¥ng"
}
function logout(){
  localStorage.removeItem("currentUser")
  location.reload()
}
function initUser(u){
  currentUser=u
  authScreen.style.display="none"
  learned=JSON.parse(localStorage.getItem(u+"_learned")||"{}")
  correct=JSON.parse(localStorage.getItem(u+"_correct")||"{}")
  score=Number(localStorage.getItem(u+"_score")||0)
  updateStatsUI()
}
function save(){
  localStorage.setItem(currentUser+"_learned",JSON.stringify(learned))
  localStorage.setItem(currentUser+"_correct",JSON.stringify(correct))
  localStorage.setItem(currentUser+"_score",score)
  updateStatsUI()
}
function updateStatsUI(){
  document.getElementById("score").innerText=score
  document.getElementById("lv").innerText=Math.floor(score/100)+1
}
if(currentUser) initUser(currentUser)

/* WORD DATA */
const URL="https://opensheet.elk.sh/11RjgH-4a8mENEkDNTv2UFsRzZGy73JJ9YNXz5HR2Tt8/Sheet1"
let words=[]
fetch(URL).then(r=>r.json()).then(d=>words=d)

/* FLASH */
let fi=0,front=true
function openFlash(){
  const w=words[fi]
  englishContent.innerHTML=`
  <div class="flashcard" onclick="flip()">
    ${front?w.EN:w.VI}
    ${!front&&w.Example?`<div class="flash-example">${w.Example}</div>`:""}
  </div>
  <div class="flash-actions">
    <button class="skip" onclick="markKnown()">ƒê√£ bi·∫øt</button>
    <button class="next" onclick="nextFlash()">Next</button>
  </div>`
  speak(w.EN)
}
function flip(){front=!front;openFlash()}
function nextFlash(){fi=(fi+1)%words.length;front=true;openFlash()}
function markKnown(){
  if(!learned[words[fi].EN]){
    learned[words[fi].EN]=true
    score+=5
  }
  save();nextFlash()
}

/* GAME */
let cur
function openGame(){
  englishContent.innerHTML=`
  <div class="sub-tabs">
    <button onclick="gameListen()">üîä Listen</button>
    <button onclick="gameType()">‚úçÔ∏è Type</button>
    <button onclick="gameMatch()">üîÄ Match</button>
  </div>
  <div id="gameArea"></div>`
}
function gameListen(){
  const area=gameArea
  cur=words[Math.random()*words.length|0]
  let opts=[cur.VI]
  while(opts.length<3){
    let r=words[Math.random()*words.length|0].VI
    if(!opts.includes(r))opts.push(r)
  }
  opts.sort(()=>Math.random()-.5)
  area.innerHTML=`
  <button class="listen-btn" onclick="speak(cur.EN)">üîä</button>
  ${opts.map(o=>`<div class="game-card" onclick="checkListen(this,'${o}')">${o}</div>`).join("")}
  <div id="result"></div>`
  speak(cur.EN)
}
function checkListen(el,a){
  const ok=a===cur.VI
  el.classList.add(ok?"correct":"wrong")
  result.innerText=ok?"‚úÖ ƒê√∫ng":"‚ùå Sai"
  if(ok&&!correct[cur.EN]){correct[cur.EN]=true;score+=10}
  save();setTimeout(gameListen,900)
}
function gameType(){
  cur=words[Math.random()*words.length|0]
  gameArea.innerHTML=`
  <button class="listen-btn" onclick="speak(cur.EN)">üîä</button>
  <input class="dict-search" placeholder="G√µ t·ª´..."
    onkeydown="if(event.key==='Enter')checkType(this)">
  <div id="result"></div>`
  speak(cur.EN)
}
function checkType(i){
  const ok=i.value.trim().toLowerCase()===cur.EN.toLowerCase()
  result.innerText=ok?"‚úÖ Ch√≠nh x√°c":"‚ùå "+cur.EN
  if(ok&&!correct[cur.EN]){correct[cur.EN]=true;score+=10}
  save();setTimeout(gameType,1000)
}
function gameMatch(){
  cur=words[Math.random()*words.length|0]
  let wrong
  do{wrong=words[Math.random()*words.length|0]}while(wrong.EN===cur.EN)
  const isOk=Math.random()>.5
  gameArea.innerHTML=`
  <div class="game-card" onclick="checkMatch(this,${isOk})">${cur.EN} ‚Äì ${isOk?cur.VI:wrong.VI}</div>
  <div class="game-card" onclick="checkMatch(this,${!isOk})">${cur.EN} ‚Äì ${isOk?wrong.VI:cur.VI}</div>
  <div id="result"></div>`
}
function checkMatch(el,ok){
  el.classList.add(ok?"correct":"wrong")
  result.innerText=ok?"‚úÖ Chu·∫©n":"‚ùå Sai"
  if(ok&&!correct[cur.EN]){correct[cur.EN]=true;score+=10}
  save();setTimeout(gameMatch,900)
}

/* DICT */
function openDict(){
  englishContent.innerHTML=`
  <div class="dict-app">
    <input class="dict-search" placeholder="T√¨m t·ª´..."
      oninput="searchDict(this.value)">
    <div id="dictList"></div>
  </div>`
  renderDict(words)
}
function renderDict(list){
  dictList.innerHTML=list.map(w=>`
  <div class="dict-card" onclick="speak('${w.EN}')">
    <b>${w.EN}</b> ‚Äì ${w.VI}
    <div class="dict-example">${w.Example||""}</div>
  </div>`).join("")
}
function searchDict(k){
  const key=k.toLowerCase()
  renderDict(words.filter(w=>
    w.EN.toLowerCase().includes(key)||
    w.VI.toLowerCase().includes(key)))
}

/* STATS */
function openStats(){
  englishContent.innerHTML=`
  <div class="stats">
    <h3>üìä Th·ªëng k√™</h3>
    <p>T·ªïng t·ª´: ${words.length}</p>
    <p>ƒê√£ bi·∫øt: ${Object.keys(learned).length}</p>
    <p>Tr·∫£ l·ªùi ƒë√∫ng: ${Object.keys(correct).length}</p>
    <p>ƒêi·ªÉm: ${score}</p>
    <p>Level: ${Math.floor(score/100)+1}</p>
  </div>`
}

/* SPEAK */
function speak(t){
  speechSynthesis.cancel()
  const u=new SpeechSynthesisUtterance(t)
  u.lang="en-US"
  speechSynthesis.speak(u)
}
</script>

</body>
</html>
