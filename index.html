<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<title>Mini Life App</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  touch-action: manipulation;
  -webkit-user-select: none;
  user-select: none;
  font-family: "Segoe UI", Arial, sans-serif;
  background: linear-gradient(135deg, #FFE6F0, #FFF6CC);
  min-height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
}

/* ===== CARD ===== */
.screen {
  background: #fff;
  width: 94%;
  max-width: 430px;
  padding: 22px;
  border-radius: 20px;
  box-shadow: 0 12px 30px rgba(0,0,0,0.1);
  text-align: center;
  display: none;
}

h2, h3 {
  margin: 10px 0;
  color: #333;
}

/* ===== BUTTON ===== */
button {
  padding: 12px;
  margin: 6px;
  border-radius: 14px;
  border: none;
  font-size: 15px;
  cursor: pointer;
  background: linear-gradient(135deg, #FFB6D5, #FFD6E8);
}

button:active { transform: scale(0.95); }

.bigBtn {
  width: 92%;
  padding: 16px;
  font-size: 17px;
}

/* ===== INPUT ===== */
input {
  width: 88%;
  padding: 11px;
  border-radius: 10px;
  border: 1px solid #ddd;
  font-size: 15px;
}

/* ===== GAME ===== */
#answers button { width: 90%; }
#timer { color: #FF6F91; font-weight: bold; }
#score { color: #4CAF50; font-weight: bold; }

/* ===== SEARCH ===== */
#searchBox { margin: 10px 0; }
#suggestBox {
  background: #fff;
  border: 1px solid #eee;
  border-radius: 8px;
  max-height: 120px;
  overflow: auto;
  text-align: left;
  font-size: 13px;
}
.suggestItem { padding: 6px 10px; cursor: pointer; }
.suggestItem:hover { background: #FFF1F6; }
</style>
</head>

<body>

<!-- ===== HOME ===== -->
<div id="home" class="screen" style="display:block;">
  <h2>ğŸ  Home</h2>
  <button class="bigBtn" onclick="openEnglish()">ğŸ“˜ Há»c tiáº¿ng Anh</button>
  <button class="bigBtn" onclick="openFood()">ğŸœ Ä‚n</button>
  <button class="bigBtn" onclick="openTravel()">ğŸš¢ Du lá»‹ch</button>
  <button class="bigBtn" onclick="openMemory()">ğŸ’– Ká»‰ niá»‡m</button>
</div>

<!-- ===== LOGIN ===== -->
<div id="login" class="screen">
  <h3>ğŸ® English Game</h3>
  <input id="playerName" placeholder="Nháº­p tÃªn">
  <br><br>
  <button onclick="startGame()">Báº¯t Ä‘áº§u</button>
  <br><br>
  <button onclick="backHome()">â¬… Home</button>
</div>

<!-- ===== GAME ===== -->
<div id="game" class="screen">
  <h3 id="welcome"></h3>

  <button onclick="setMode('quiz')">Tráº¯c nghiá»‡m</button>
  <button onclick="setMode('text')">Tá»± luáº­n</button>

  <div id="searchBox">
    <input id="searchInput" placeholder="ğŸ” TÃ¬m tá»«" oninput="suggestWord()">
    <button onclick="searchWord()">TÃ¬m</button>
    <div id="suggestBox"></div>
    <div id="searchResult"></div>
  </div>

  <div id="timer">â±ï¸ 10</div>
  <h3 id="question"></h3>

  <div id="answers"></div>

  <div id="textBox" style="display:none;">
    <input id="textInput" placeholder="Nháº­p Ä‘Ã¡p Ã¡n">
    <button onclick="checkText()">OK</button>
  </div>

  <div id="rating" style="display:none;">
    <h4>Äá»™ khÃ³?</h4>
    <button onclick="rate('easy')">ğŸ˜„ Dá»…</button>
    <button onclick="rate('good')">ğŸ™‚ Good</button>
    <button onclick="rate('hard')">ğŸ˜ KhÃ³</button>
    <button onclick="rate('extreme')">ğŸ”¥ Cá»±c khÃ³</button>
  </div>

  <h3>Äiá»ƒm: <span id="score">0</span></h3>
  <button onclick="backHome()">â¬… Home</button>
</div>

<!-- ===== FOOD ===== -->
<div id="food" class="screen">
  <h3>ğŸœ Ä‚n</h3>
  <p>Flashcard mÃ³n Äƒn, giÃ¡ tiá»n, tá»« vá»±ng</p>
  <button onclick="backHome()">â¬… Home</button>
</div>

<!-- ===== TRAVEL ===== -->
<div id="travel" class="screen">
  <h3>ğŸš¢ Du lá»‹ch</h3>
  <p>Tá»« vá»±ng cruise, hotel, itinerary</p>
  <button onclick="backHome()">â¬… Home</button>
</div>

<!-- ===== MEMORY ===== -->
<div id="memory" class="screen">
  <h3>ğŸ’– Ká»‰ niá»‡m</h3>
  <p>LÆ°u tá»« yÃªu thÃ­ch, cÃ¢u hay</p>
  <button onclick="backHome()">â¬… Home</button>
</div>

<!-- ===== SOUND ===== -->
<audio id="right" src="https://actions.google.com/sounds/v1/cartoon/pop.ogg"></audio>
<audio id="wrong" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"></audio>
<audio id="timeup" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>

<script>
const screens = ["home","login","game","food","travel","memory"];
const show = id => screens.forEach(s => document.getElementById(s).style.display = s===id?"block":"none");

function backHome(){ show("home"); }
function openEnglish(){ show("login"); }
function openFood(){ show("food"); }
function openTravel(){ show("travel"); }
function openMemory(){ show("memory"); }

/* ===== GAME LOGIC ===== */
const SHEET_ID = "11RjgH-4a8mENEkDNTv2UFsRzZGy73JJ9YNXz5HR2Tt8";
const URL = `https://opensheet.elk.sh/${SHEET_ID}/Sheet1`;

let words=[], current=null, score=0, mode="quiz", timer=null, timeLeft=10, direction=true;

fetch(URL).then(r=>r.json()).then(d=>{
  words = d.map(x=>({en:x.EN, vi:x.VI, weight:1}));
});

function startGame(){
  if(!playerName.value.trim()) return alert("Nháº­p tÃªn");
  welcome.innerText = "Xin chÃ o, " + playerName.value;
  show("game");
  nextQuestion();
}

function setMode(m){ mode=m; nextQuestion(); }

function pickWord(){
  let t = words.reduce((s,w)=>s+w.weight,0), r=Math.random()*t;
  for(let w of words){ if((r-=w.weight)<=0) return w; }
}

function startTimer(){
  clearInterval(timer);
  timeLeft=10; timerEl.innerText="â±ï¸ "+timeLeft;
  timer=setInterval(()=>{
    timerEl.innerText="â±ï¸ "+(--timeLeft);
    if(timeLeft<=0){
      clearInterval(timer);
      play(timeup);
      score=Math.max(0,score-1);
      scoreEl.innerText=score;
      rating.style.display="block";
    }
  },1000);
}

function nextQuestion(){
  rating.style.display="none";
  answers.innerHTML="";
  textInput.value="";
  current=pickWord();
  direction=Math.random()>0.5;
  question.innerText=direction?current.vi:current.en;
  mode==="quiz"?(createChoices(),textBox.style.display="none"):(answers.style.display="none",textBox.style.display="block");
  startTimer();
}

function createChoices(){
  answers.style.display="block";
  const list=[...words].sort(()=>0.5-Math.random()).slice(0,3);
  if(!list.includes(current)) list[0]=current;
  list.forEach(w=>{
    const b=document.createElement("button");
    b.innerText=direction?w.en:w.vi;
    b.onclick=()=>checkAnswer(b.innerText);
    answers.appendChild(b);
  });
}

function checkAnswer(v){
  clearInterval(timer);
  const c=direction?current.en:current.vi;
  if(v.trim().toLowerCase()===c.toLowerCase()){
    play(right); score++;
  } else {
    play(wrong); score=Math.max(0,score-1);
  }
  scoreEl.innerText=score;
  rating.style.display="block";
}

function checkText(){ checkAnswer(textInput.value); }
function rate(){ nextQuestion(); }

function play(s){ s.currentTime=0; s.play(); }

const timerEl=document.getElementById("timer");
const scoreEl=document.getElementById("score");
</script>

</body>
</html>
